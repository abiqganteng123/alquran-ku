<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-QuranKu</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-light: #60ad5e;
            --primary-dark: #005005;
            --primary-transparent: rgba(46, 125, 50, 0.1);
            --text: #333;
            --text-light: #666;
            --bg: #f9f9f9;
            --card-bg: #fff;
            --border: #e0e0e0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            
            /* RGB Animation Variables */
            --rgb-1: 46, 125, 50;
            --rgb-2: 96, 173, 94;
            --rgb-3: 0, 80, 5;
        }

        [data-theme="dark"] {
            --primary: #60ad5e;
            --primary-light: #2e7d32;
            --primary-dark: #005005;
            --primary-transparent: rgba(96, 173, 94, 0.1);
            --text: #f0f0f0;
            --text-light: #b0b0b0;
            --bg: #121212;
            --card-bg: #1e1e1e;
            --border: #333;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            
            /* Dark mode RGB colors */
            --rgb-1: 96, 173, 94;
            --rgb-2: 46, 125, 50;
            --rgb-3: 0, 80, 5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            direction: rtl;
            transition: background-color 0.5s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            position: relative;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, 
                rgba(var(--rgb-1), 0.8), 
                rgba(var(--rgb-2), 0.6), 
                rgba(var(--rgb-3), 0.4));
            z-index: -1;
            border-radius: 50px;
            opacity: 0;
            transition: var(--transition);
        }

        .logo:hover::before {
            opacity: 1;
            animation: rgbPulse 6s infinite alternate;
        }

        @keyframes rgbPulse {
            0% { background: linear-gradient(45deg, rgba(var(--rgb-1), 0.8), rgba(var(--rgb-2), 0.6), rgba(var(--rgb-3), 0.4)); }
            33% { background: linear-gradient(45deg, rgba(var(--rgb-2), 0.8), rgba(var(--rgb-3), 0.6), rgba(var(--rgb-1), 0.4)); }
            66% { background: linear-gradient(45deg, rgba(var(--rgb-3), 0.8), rgba(var(--rgb-1), 0.6), rgba(var(--rgb-2), 0.4)); }
            100% { background: linear-gradient(45deg, rgba(var(--rgb-1), 0.8), rgba(var(--rgb-3), 0.6), rgba(var(--rgb-2), 0.4)); }
        }

        .logo i {
            font-size: 28px;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: var(--radius);
            background-color: var(--primary);
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(var(--rgb-1), 0.8), 
                rgba(var(--rgb-2), 0.6), 
                rgba(var(--rgb-3), 0.4));
            z-index: -1;
            opacity: 0;
            transition: var(--transition);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            background-color: var(--primary-dark);
        }

        .btn:hover::after {
            opacity: 1;
            animation: rgbPulse 6s infinite alternate;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary-transparent);
        }

        .btn-icon {
            padding: 10px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            justify-content: center;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .surah-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .surah-container {
                grid-template-columns: 1fr;
            }
        }

        .surah-list {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            height: calc(100vh - 160px);
            overflow-y: auto;
            transition: var(--transition);
        }

        .surah-list::-webkit-scrollbar {
            width: 6px;
        }

        .surah-list::-webkit-scrollbar-track {
            background: var(--bg);
        }

        .surah-list::-webkit-scrollbar-thumb {
            background-color: var(--primary-light);
            border-radius: 3px;
        }

        .surah-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-box {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--bg);
            color: var(--text);
            font-family: inherit;
            margin-bottom: 20px;
            transition: var(--transition);
            font-size: 14px;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-transparent);
        }

        .surah-card {
            padding: 14px;
            border-radius: var(--radius);
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .surah-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, 
                rgba(var(--rgb-1), 1), 
                rgba(var(--rgb-2), 0.8), 
                rgba(var(--rgb-3), 0.6));
            transition: var(--transition);
            opacity: 0;
        }

        .surah-card:hover {
            background-color: var(--primary-transparent);
            border-color: var(--primary-light);
            transform: translateX(-4px);
        }

        .surah-card:hover::before {
            opacity: 1;
            animation: rgbPulse 6s infinite alternate;
        }

        .surah-card.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .surah-card.active::before {
            opacity: 1;
            background: white;
            width: 5px;
        }

        .surah-number {
            width: 32px;
            height: 32px;
            background-color: var(--primary-light);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .surah-card.active .surah-number {
            background-color: white;
            color: var(--primary);
        }

        .surah-name {
            flex: 1;
            font-weight: 500;
        }

        .surah-details {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .surah-ayat {
            font-size: 13px;
            color: var(--text-light);
        }

        .surah-card.active .surah-ayat {
            color: rgba(255, 255, 255, 0.8);
        }

        .surah-revelation {
            font-size: 12px;
            background-color: var(--bg);
            color: var(--text-light);
            padding: 3px 8px;
            border-radius: 12px;
        }

        .surah-card.active .surah-revelation {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .ayat-container {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            height: calc(100vh - 160px);
            overflow-y: auto;
            transition: var(--transition);
        }

        .ayat-container::-webkit-scrollbar {
            width: 6px;
        }

        .ayat-container::-webkit-scrollbar-track {
            background: var(--bg);
        }

        .ayat-container::-webkit-scrollbar-thumb {
            background-color: var(--primary-light);
            border-radius: 3px;
        }

        .surah-header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            position: relative;
        }

        .surah-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 25%;
            width: 50%;
            height: 2px;
            background: linear-gradient(to right, 
                rgba(var(--rgb-1), 0), 
                rgba(var(--rgb-1), 0.8), 
                rgba(var(--rgb-1), 0));
            transition: var(--transition);
        }

        .surah-title {
            font-family: 'Amiri', serif;
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 8px;
            line-height: 1.3;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .surah-meta {
            display: flex;
            justify-content: center;
            gap: 15px;
            color: var(--text-light);
            font-size: 15px;
        }

        .bismillah {
            font-family: 'Amiri', serif;
            font-size: 28px;
            text-align: center;
            margin: 24px 0;
            color: var(--primary-dark);
            line-height: 1.8;
            position: relative;
        }

        .bismillah::before, .bismillah::after {
            content: '✿';
            color: var(--primary-light);
            margin: 0 15px;
            font-size: 20px;
            opacity: 0.6;
        }

        .ayat-item {
            margin-bottom: 28px;
            animation: fadeIn 0.5s ease-out;
            padding: 16px;
            border-radius: var(--radius);
            transition: var(--transition);
            position: relative;
        }

        .ayat-item:hover {
            background-color: var(--primary-transparent);
        }

        .ayat-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, var(--primary-light) 0%, transparent 70%);
            opacity: 0;
            transition: var(--transition);
        }

        .ayat-item:hover::before {
            opacity: 0.3;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ayat-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background-color: var(--primary-light);
            color: white;
            border-radius: 50%;
            font-size: 13px;
            font-weight: 600;
            margin-left: 12px;
            transition: var(--transition);
        }

        .ayat-item:hover .ayat-number {
            transform: scale(1.1);
            background: linear-gradient(45deg, 
                rgba(var(--rgb-1), 0.8), 
                rgba(var(--rgb-2), 0.6));
        }

        .ayat-arabic {
            font-family: 'Amiri', serif;
            font-size: 24px;
            line-height: 2.2;
            text-align: right;
            margin: 12px 0;
            font-weight: 500;
            transition: var(--transition);
        }

        .ayat-latin {
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            color: var(--text-light);
            font-style: italic;
            margin: 8px 0;
            line-height: 1.6;
            direction: ltr;
            text-align: left;
        }

        .ayat-translation {
            font-size: 16px;
            color: var(--text-light);
            margin: 12px 0;
            padding-right: 12px;
            border-right: 2px solid var(--primary-light);
            line-height: 1.7;
            transition: var(--transition);
        }

        .ayat-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .tafsir-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            background-color: var(--bg);
            border-radius: var(--radius);
            margin-top: 10px;
        }

        .tafsir-container.open {
            max-height: 500px;
            padding: 16px;
            margin-top: 16px;
            border: 1px solid var(--border);
        }

        .tafsir-content {
            font-size: 14px;
            line-height: 1.8;
        }

        .audio-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            border-top: 1px solid var(--border);
        }

        .audio-player.show {
            transform: translateY(0);
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }

        .audio-info {
            flex: 1;
            min-width: 0;
        }

        .audio-title {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .audio-surah {
            font-size: 13px;
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .progress-container {
            flex: 3;
            height: 5px;
            background-color: var(--border);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 3px;
            width: 0%;
            position: relative;
            transition: width 0.1s linear;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-container:hover .progress-bar::after {
            opacity: 1;
        }

        .time {
            font-size: 13px;
            color: var(--text-light);
            min-width: 45px;
            text-align: center;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 350px;
            max-width: 90%;
            background-color: var(--card-bg);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
            padding: 24px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            overflow-y: auto;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .settings-title {
            font-size: 20px;
            font-weight: 600;
        }

        .settings-group {
            margin-bottom: 24px;
        }

        .settings-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 15px;
        }

        .select-box {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--bg);
            color: var(--text);
            font-family: inherit;
            font-size: 14px;
            transition: var(--transition);
        }

        .select-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-transparent);
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .range-value {
            font-size: 14px;
            min-width: 30px;
            text-align: center;
        }

        .range-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            outline: none;
            transition: var(--transition);
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            backdrop-filter: blur(3px);
        }

        .overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        .play-surah-btn {
            margin: 24px auto;
            display: block;
            width: 100%;
            max-width: 300px;
        }

        .bookmark-btn {
            position: absolute;
            top: 15px;
            left: 20px;
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .bookmark-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, 
                rgba(var(--rgb-1), 0.8), 
                rgba(var(--rgb-2), 0.6));
        }

        .bookmark-btn.bookmarked {
            background: #f44336;
        }

        .bookmark-btn.bookmarked:hover {
            background: linear-gradient(45deg, 
                rgba(244, 67, 54, 0.8), 
                rgba(244, 67, 54, 0.6));
        }

        .bookmarks-panel {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 350px;
            max-width: 90%;
            background-color: var(--card-bg);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            padding: 24px;
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            overflow-y: auto;
        }

        .bookmarks-panel.open {
            transform: translateX(0);
        }

        .bookmark-item {
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--border);
            position: relative;
        }

        .bookmark-item:hover {
            background-color: var(--primary-transparent);
            border-color: var(--primary-light);
        }

        .bookmark-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, 
                rgba(var(--rgb-1), 1), 
                rgba(var(--rgb-2), 0.8), 
                rgba(var(--rgb-3), 0.6));
            opacity: 0;
            transition: var(--transition);
        }

        .bookmark-item:hover::before {
            opacity: 1;
            animation: rgbPulse 6s infinite alternate;
        }

        .bookmark-actions {
            margin-left: auto;
            display: flex;
            gap: 5px;
        }

        .bookmark-delete {
            background: transparent;
            border: none;
            color: #f44336;
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
        }

        .bookmark-item:hover .bookmark-delete {
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary-light);
        }

        /* Last Read Feature */
        .last-read {
            background-color: var(--primary-transparent);
            border: 1px solid var(--primary-light);
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .last-read:hover {
            background-color: var(--primary-light);
            color: white;
        }

        .last-read-label {
            font-size: 12px;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .last-read .surah-name {
            font-weight: 600;
        }

        .last-read:hover .last-read-label {
            color: white;
        }

        /* Night Mode Toggle Animation */
        .theme-toggle-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease;
        }

        .theme-toggle-animation.active {
            opacity: 0.8;
        }

        /* About Modal */
        .about-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .about-modal.open {
            opacity: 1;
            pointer-events: all;
        }

        .about-modal-content {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .about-modal.open .about-modal-content {
            transform: translateY(0);
        }

        .close-about-modal {
            position: absolute;
            top: 15px;
            left: 15px;
            background: transparent;
            border: none;
            color: var(--text-light);
            font-size: 20px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-about-modal:hover {
            color: var(--primary);
        }

        .about-header {
            margin-bottom: 20px;
        }

        .about-header i {
            font-size: 50px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .about-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .about-text {
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--text);
        }

        .creator-name {
            display: inline-block;
            margin-top: 15px;
            padding: 8px 15px;
            background: linear-gradient(45deg, 
                rgba(var(--rgb-1), 0.8), 
                rgba(var(--rgb-2), 0.6));
            color: white;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .creator-name:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(var(--rgb-1), 0.3);
        }

        /* Share Modal */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .share-modal.open {
            opacity: 1;
            pointer-events: all;
        }

        .share-modal-content {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .share-modal.open .share-modal-content {
            transform: translateY(0);
        }

        .close-share-modal {
            position: absolute;
            top: 15px;
            left: 15px;
            background: transparent;
            border: none;
            color: var(--text-light);
            font-size: 20px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-share-modal:hover {
            color: var(--primary);
        }

        .share-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .share-input-container {
            display: flex;
            margin-bottom: 20px;
        }

        .share-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius) 0 0 var(--radius);
            background-color: var(--bg);
            color: var(--text);
            font-family: inherit;
            font-size: 14px;
        }

        .share-copy-btn {
            padding: 10px 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0 var(--radius) var(--radius) 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .share-copy-btn:hover {
            background-color: var(--primary-dark);
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .share-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
        }

        .share-btn.whatsapp {
            background-color: #25D366;
        }

        .share-btn.facebook {
            background-color: #3b5998;
        }

        .share-btn.twitter {
            background-color: #1DA1F2;
        }

        .share-btn.telegram {
            background-color: #0088cc;
        }

        .share-btn:hover {
            transform: scale(1.1);
        }

        @media (max-width: 480px) {
            .surah-title {
                font-size: 24px;
            }
            .bismillah {
                font-size: 22px;
            }
            .ayat-arabic {
                font-size: 20px;
            }
            .ayat-translation {
                font-size: 14px;
            }
            .audio-player {
                flex-direction: column;
                gap: 12px;
                padding: 12px;
            }
            .audio-controls {
                width: 100%;
            }
            .bookmark-btn {
                top: 10px;
                left: 10px;
                width: 36px;
                height: 36px;
            }
            .about-modal-content {
                padding: 20px;
            }
            .about-header i {
                font-size: 40px;
            }
            .about-title {
                font-size: 20px;
            }
            .share-modal-content {
                padding: 20px;
            }
            .share-title {
                font-size: 18px;
            }
        }

        /* Animation for theme switch */
        @keyframes themeSwitch {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .theme-transition {
            animation: themeSwitch 0.6s ease;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 100;
            transition: var(--transition);
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, 
                rgba(var(--rgb-1), 0.8), 
                rgba(var(--rgb-2), 0.6));
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-quran"></i>
                <span>Al-QuranKu</span>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline" id="bookmarksToggle">
                    <i class="fas fa-bookmark"></i>
                </button>
                <button class="btn btn-outline" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn btn-outline" id="settingsToggle">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <div class="surah-container">
            <div class="surah-list">
                <div class="surah-list-header">
                    <h2>Daftar Surah</h2>
                </div>
                <input type="text" class="search-box" placeholder="Cari surah...">
                <div id="lastRead"></div>
                <div id="surahList">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div class="ayat-container">
                <button class="bookmark-btn" id="bookmarkBtn" title="Bookmark Ayat">
                    <i class="far fa-bookmark"></i>
                </button>
                <div class="surah-header">
                    <h1 class="surah-title">Pilih surah</h1>
                    <div class="surah-meta">
                        <span>0 ayat</span>
                        <span>•</span>
                        <span>Mekah</span>
                    </div>
                </div>
                <div id="ayatContent">
                    <div class="empty-state">
                        <i class="fas fa-quran"></i>
                        <p>Silakan pilih surah untuk mulai membaca</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="audio-player" id="audioPlayer">
        <div class="audio-controls">
            <button class="btn btn-icon" id="playPauseBtn">
                <i class="fas fa-play"></i>
            </button>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <span class="time" id="currentTime">0:00</span>
            <span class="time" id="duration">0:00</span>
        </div>
        <div class="audio-info">
            <div class="audio-title" id="audioTitle">Memuat audio...</div>
            <div class="audio-surah" id="audioSurah">-</div>
        </div>
    </div>

    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3 class="settings-title">Pengaturan</h3>
            <button class="btn btn-icon" id="closeSettingsBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="settings-group">
            <label class="settings-label">Tema</label>
            <label class="theme-switch">
                <input type="checkbox" id="themeSwitch">
                <span class="slider"></span>
            </label>
        </div>
        <div class="settings-group">
            <label class="settings-label">Ukuran Font Arab</label>
            <div class="range-container">
                <input type="range" min="16" max="32" value="24" class="range-slider" id="arabicFontSize">
                <span class="range-value" id="arabicFontSizeValue">24</span>
            </div>
        </div>
        <div class="settings-group">
            <label class="settings-label">Ukuran Font Terjemahan</label>
            <div class="range-container">
                <input type="range" min="12" max="20" value="16" class="range-slider" id="translationFontSize">
                <span class="range-value" id="translationFontSizeValue">16</span>
            </div>
        </div>
        <div class="settings-group">
            <label class="settings-label">Ukuran Font Latin</label>
            <div class="range-container">
                <input type="range" min="10" max="18" value="14" class="range-slider" id="latinFontSize">
                <span class="range-value" id="latinFontSizeValue">14</span>
            </div>
        </div>
        <div class="settings-group">
            <label class="settings-label">Qari</label>
            <select class="select-box" id="qariSelect">
                <option value="01">Abdullah Al-Juhany</option>
                <option value="02">Abdul Muhsin Al-Qasim</option>
                <option value="03">Abdurrahman as-Sudais</option>
                <option value="04">Ibrahim Al-Dossari</option>
                <option value="05">Misyari Rasyid Al-Afasi</option>
            </select>
        </div>
        <div class="settings-group">
            <label class="settings-label">Reset Pengaturan</label>
            <button class="btn btn-outline" id="resetSettingsBtn">
                <i class="fas fa-undo"></i> Reset ke Default
            </button>
        </div>
        <div class="settings-group">
            <button class="btn btn-outline" id="aboutBtn">
                <i class="fas fa-info-circle"></i> Tentang
            </button>
        </div>
    </div>

    <div class="bookmarks-panel" id="bookmarksPanel">
        <div class="settings-header">
            <h3 class="settings-title">Bookmark Ayat</h3>
            <button class="btn btn-icon" id="closeBookmarksBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="bookmarksList">
            <div class="empty-state">
                <i class="far fa-bookmark"></i>
                <p>Belum ada ayat yang dibookmark</p>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    
    <!-- Floating Action Button -->
    <div class="fab" id="fab">
        <i class="fas fa-share-alt"></i>
    </div>
    
    <!-- About Modal -->
    <div class="about-modal" id="aboutModal">
        <div class="about-modal-content">
            <button class="close-about-modal" id="closeAboutModal">
                <i class="fas fa-times"></i>
            </button>
            <div class="about-header">
                <i class="fas fa-quran"></i>
                <h2 class="about-title">Al-QuranKu</h2>
            </div>
            <div class="about-text">
                <p>Website ini dibuat untuk memudahkan umat Islam dalam membaca dan mempelajari Al-Quran secara digital. Dengan fitur-fitur lengkap seperti:</p>
                <ul style="text-align: right; margin-right: 20px; margin-top: 10px;">
                    <li>Daftar seluruh surah Al-Quran</li>
                    <li>Teks Arab dengan terjemahan</li>
                    <li>Audio murattal dari berbagai qari</li>
                    <li>Bookmark ayat favorit</li>
                    <li>Tafsir ayat</li>
                    <li>Mode terang/gelap</li>
                </ul>
                <p>Semoga website ini bermanfaat untuk meningkatkan kecintaan kita terhadap Al-Quran</p>
            </div>
            <div class="creator-name" id="creatorName">
                Dibuat oleh: @ab.iqqq
            </div>
        </div>
    </div>
    
    <!-- Share Modal -->
    <div class="share-modal" id="shareModal">
        <div class="share-modal-content">
            <button class="close-share-modal" id="closeShareModal">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="share-title">Bagikan Ayat</h3>
            <div class="share-input-container">
                <input type="text" class="share-input" id="shareLinkInput" readonly>
                <button class="share-copy-btn" id="copyLinkBtn">Salin</button>
            </div>
            <div class="share-buttons">
                <div class="share-btn whatsapp" id="whatsappShare">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <div class="share-btn facebook" id="facebookShare">
                    <i class="fab fa-facebook-f"></i>
                </div>
                <div class="share-btn twitter" id="twitterShare">
                    <i class="fab fa-twitter"></i>
                </div>
                <div class="share-btn telegram" id="telegramShare">
                    <i class="fab fa-telegram-plane"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Theme Transition Animation -->
    <div class="theme-toggle-animation" id="themeAnimation"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const surahListEl = document.getElementById('surahList');
            const ayatContentEl = document.getElementById('ayatContent');
            const audioPlayerEl = document.getElementById('audioPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressContainer');
            const currentTimeEl = document.getElementById('currentTime');
            const durationEl = document.getElementById('duration');
            const audioTitleEl = document.getElementById('audioTitle');
            const audioSurahEl = document.getElementById('audioSurah');
            const settingsPanelEl = document.getElementById('settingsPanel');
            const settingsToggleBtn = document.getElementById('settingsToggle');
            const closeSettingsBtn = document.getElementById('closeSettingsBtn');
            const overlayEl = document.getElementById('overlay');
            const themeToggleBtn = document.getElementById('themeToggle');
            const themeSwitch = document.getElementById('themeSwitch');
            const arabicFontSize = document.getElementById('arabicFontSize');
            const arabicFontSizeValue = document.getElementById('arabicFontSizeValue');
            const translationFontSize = document.getElementById('translationFontSize');
            const translationFontSizeValue = document.getElementById('translationFontSizeValue');
            const latinFontSize = document.getElementById('latinFontSize');
            const latinFontSizeValue = document.getElementById('latinFontSizeValue');
            const qariSelect = document.getElementById('qariSelect');
            const searchBox = document.querySelector('.search-box');
            const resetSettingsBtn = document.getElementById('resetSettingsBtn');
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const bookmarksToggleBtn = document.getElementById('bookmarksToggle');
            const bookmarksPanelEl = document.getElementById('bookmarksPanel');
            const closeBookmarksBtn = document.getElementById('closeBookmarksBtn');
            const bookmarksListEl = document.getElementById('bookmarksList');
            const lastReadEl = document.getElementById('lastRead');
            const fab = document.getElementById('fab');
            const aboutBtn = document.getElementById('aboutBtn');
            const aboutModal = document.getElementById('aboutModal');
            const closeAboutModal = document.getElementById('closeAboutModal');
            const creatorName = document.getElementById('creatorName');
            const themeAnimation = document.getElementById('themeAnimation');
            const shareModal = document.getElementById('shareModal');
            const closeShareModal = document.getElementById('closeShareModal');
            const shareLinkInput = document.getElementById('shareLinkInput');
            const copyLinkBtn = document.getElementById('copyLinkBtn');
            const whatsappShare = document.getElementById('whatsappShare');
            const facebookShare = document.getElementById('facebookShare');
            const twitterShare = document.getElementById('twitterShare');
            const telegramShare = document.getElementById('telegramShare');

            // State
            let surahs = [];
            let currentSurah = null;
            let currentAyat = null;
            let currentAudio = null;
            let isPlaying = false;
            let currentTheme = localStorage.getItem('theme') || 'light';
            let selectedQari = localStorage.getItem('qari') || '01';
            let audioInterval;
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];
            let lastRead = JSON.parse(localStorage.getItem('lastRead'));

            // Initialize
            setTheme(currentTheme);
            themeSwitch.checked = currentTheme === 'dark';
            qariSelect.value = selectedQari;
            updateFontSizeValues();
            fetchSurahs();
            renderBookmarks();
            renderLastRead();
            
            // Hide FAB initially
            fab.style.display = 'none';

            // Event Listeners
            settingsToggleBtn.addEventListener('click', toggleSettings);
            closeSettingsBtn.addEventListener('click', toggleSettings);
            overlayEl.addEventListener('click', closeAllPanels);
            themeToggleBtn.addEventListener('click', toggleTheme);
            themeSwitch.addEventListener('change', toggleTheme);
            arabicFontSize.addEventListener('input', updateFontSizes);
            translationFontSize.addEventListener('input', updateFontSizes);
            latinFontSize.addEventListener('input', updateFontSizes);
            qariSelect.addEventListener('change', updateQari);
            searchBox.addEventListener('input', filterSurahs);
            resetSettingsBtn.addEventListener('click', resetSettings);
            bookmarkBtn.addEventListener('click', toggleBookmark);
            bookmarksToggleBtn.addEventListener('click', toggleBookmarksPanel);
            closeBookmarksBtn.addEventListener('click', toggleBookmarksPanel);
            fab.addEventListener('click', openShareModal);
            aboutBtn.addEventListener('click', openAboutModal);
            closeAboutModal.addEventListener('click', closeAboutModalFunc);
            creatorName.addEventListener('click', () => {
                window.open('https://www.instagram.com/ab.iqqq', '_blank');
            });
            closeShareModal.addEventListener('click', closeShareModalFunc);
            copyLinkBtn.addEventListener('click', copyShareLink);
            whatsappShare.addEventListener('click', shareToWhatsApp);
            facebookShare.addEventListener('click', shareToFacebook);
            twitterShare.addEventListener('click', shareToTwitter);
            telegramShare.addEventListener('click', shareToTelegram);

            async function fetchSurahs() {
                try {
                    const response = await fetch('https://equran.id/api/v2/surat');
                    const data = await response.json();
                    surahs = data.data;
                    renderSurahList(surahs);
                    
                    // Check for URL parameters to load specific surah/ayat
                    const urlParams = new URLSearchParams(window.location.search);
                    const surahParam = urlParams.get('surah');
                    const ayatParam = urlParams.get('ayat');
                    
                    if (surahParam) {
                        loadSurah(parseInt(surahParam), () => {
                            if (ayatParam) {
                                setTimeout(() => {
                                    const ayatElement = document.querySelector(`.ayat-item[data-surah="${surahParam}"][data-ayat="${ayatParam}"]`);
                                    if (ayatElement) {
                                        ayatElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                        ayatElement.style.backgroundColor = 'var(--primary-transparent)';
                                        setTimeout(() => {
                                            ayatElement.style.backgroundColor = '';
                                        }, 2000);
                                        
                                        currentAyat = ayatParam;
                                        updateBookmarkButton(surahParam, ayatParam);
                                    }
                                }, 500);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error fetching surahs:', error);
                    surahListEl.innerHTML = '<p>Gagal memuat daftar surah. Silakan coba lagi.</p>';
                }
            }

            function renderSurahList(surahsToRender) {
                surahListEl.innerHTML = '';
                surahsToRender.forEach(surah => {
                    const surahCard = document.createElement('div');
                    surahCard.className = 'surah-card';
                    surahCard.innerHTML = `
                        <div class="surah-number">${surah.nomor}</div>
                        <div class="surah-name">${surah.namaLatin}</div>
                        <div class="surah-details">
                            <div class="surah-ayat">${surah.jumlahAyat} ayat</div>
                            <div class="surah-revelation">${surah.tempatTurun}</div>
                        </div>
                    `;
                    surahCard.addEventListener('click', () => loadSurah(surah.nomor));
                    surahListEl.appendChild(surahCard);
                });
            }
            
            function renderLastRead() {
                if (!lastRead) {
                    lastReadEl.style.display = 'none';
                    return;
                }
                
                lastReadEl.innerHTML = `
                    <div class="last-read" data-surah="${lastRead.surah}" data-ayat="${lastRead.ayat}">
                        <div class="last-read-label">Terakhir Dibaca</div>
                        <div class="surah-name">${lastRead.surahName} : ${lastRead.ayat}</div>
                        <div class="surah-ayat">${lastRead.arabicText.substring(0, 30)}...</div>
                    </div>
                `;
                
                lastReadEl.querySelector('.last-read').addEventListener('click', () => {
                    const surahNumber = lastRead.surah;
                    const ayatNumber = lastRead.ayat;
                    
                    // Load the surah
                    loadSurah(surahNumber);
                    
                    // Scroll to the ayat after a short delay
                    setTimeout(() => {
                        const ayatElement = document.querySelector(`.ayat-item[data-surah="${surahNumber}"][data-ayat="${ayatNumber}"]`);
                        if (ayatElement) {
                            ayatElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            
                            // Highlight the ayat temporarily
                            ayatElement.style.backgroundColor = 'var(--primary-transparent)';
                            setTimeout(() => {
                                ayatElement.style.backgroundColor = '';
                            }, 2000);
                            
                            // Set current ayat and update bookmark button
                            currentAyat = ayatNumber;
                            updateBookmarkButton(surahNumber, ayatNumber);
                        }
                    }, 500);
                });
            }
            
            function saveLastRead(surahNumber, ayatNumber) {
                const surah = surahs.find(s => s.nomor === surahNumber);
                const ayat = surah.ayat.find(a => a.nomorAyat === parseInt(ayatNumber));
                
                lastRead = {
                    surah: surahNumber,
                    ayat: ayatNumber,
                    surahName: surah.namaLatin,
                    arabicText: ayat.teksArab,
                    latinText: ayat.teksLatin,
                    translation: ayat.teksIndonesia,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('lastRead', JSON.stringify(lastRead));
                renderLastRead();
            }

            async function loadSurah(surahNumber, callback) {
                // Update active state in list
                document.querySelectorAll('.surah-card').forEach(card => {
                    card.classList.remove('active');
                });
                document.querySelectorAll('.surah-card')[surahNumber - 1].classList.add('active');

                // Show loading state
                ayatContentEl.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                `;

                try {
                    const response = await fetch(`https://equran.id/api/v2/surat/${surahNumber}`);
                    const data = await response.json();
                    currentSurah = data.data;
                    renderSurah(currentSurah);
                    
                    // Show FAB when surah is loaded
                    fab.style.display = 'flex';
                    
                    if (callback) callback();
                } catch (error) {
                    console.error('Error fetching surah:', error);
                    ayatContentEl.innerHTML = '<p>Gagal memuat surah. Silakan coba lagi.</p>';
                }
            }

            function renderSurah(surah) {
                // Update header
                document.querySelector('.surah-title').textContent = `${surah.namaLatin} - ${surah.nama}`;
                document.querySelector('.surah-meta').innerHTML = `
                    <span>${surah.jumlahAyat} ayat</span>
                    <span>•</span>
                    <span>${surah.tempatTurun}</span>
                `;

                // Render ayat
                let ayatHTML = '';
                
                // Add play full surah button
                ayatHTML += `
                    <button class="btn play-surah-btn" id="playSurahBtn">
                        <i class="fas fa-play"></i> Putar Surah ${surah.namaLatin}
                    </button>
                `;
                
                if (surah.nomor !== 1 && surah.nomor !== 9) {
                    ayatHTML += `<div class="bismillah">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>`;
                }

                surah.ayat.forEach(ayat => {
                    const isBookmarked = bookmarks.some(b => b.surah === surah.nomor && b.ayat === ayat.nomorAyat);
                    ayatHTML += `
                        <div class="ayat-item" data-surah="${surah.nomor}" data-ayat="${ayat.nomorAyat}">
                            <div class="ayat-arabic">${ayat.teksArab} <span class="ayat-number">${ayat.nomorAyat}</span></div>
                            <div class="ayat-latin">${ayat.teksLatin}</div>
                            <div class="ayat-translation">${ayat.teksIndonesia}</div>
                            <div class="ayat-actions">
                                <button class="btn btn-outline btn-sm play-ayat" data-ayat="${ayat.nomorAyat}">
                                    <i class="fas fa-play"></i> Play
                                </button>
                                <button class="btn btn-outline btn-sm show-tafsir">
                                    <i class="fas fa-book-open"></i> Tafsir
                                </button>
                            </div>
                            <div class="tafsir-container">
                                <div class="tafsir-content">Memuat tafsir...</div>
                            </div>
                        </div>
                    `;
                });

                ayatContentEl.innerHTML = ayatHTML;

                // Add event listener to play full surah button
                document.getElementById('playSurahBtn').addEventListener('click', () => {
                    playFullSurah(surah.nomor);
                });

                // Add event listeners to ayat play buttons
                document.querySelectorAll('.play-ayat').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const ayatNumber = e.target.getAttribute('data-ayat');
                        currentAyat = ayatNumber;
                        playAyat(surah.nomor, ayatNumber);
                        updateBookmarkButton(surah.nomor, ayatNumber);
                        saveLastRead(surah.nomor, ayatNumber);
                    });
                });

                // Add event listeners to tafsir buttons
                document.querySelectorAll('.show-tafsir').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const ayatItem = e.target.closest('.ayat-item');
                        const ayatNumber = ayatItem.getAttribute('data-ayat');
                        const tafsirContainer = ayatItem.querySelector('.tafsir-container');
                        const tafsirContent = tafsirContainer.querySelector('.tafsir-content');
                        
                        if (tafsirContainer.classList.contains('open')) {
                            tafsirContainer.classList.remove('open');
                            e.target.innerHTML = '<i class="fas fa-book-open"></i> Tafsir';
                        } else {
                            // Load tafsir if not already loaded
                            if (tafsirContent.textContent === 'Memuat tafsir...') {
                                loadTafsir(surah.nomor, ayatNumber, tafsirContent);
                            }
                            tafsirContainer.classList.add('open');
                            e.target.innerHTML = '<i class="fas fa-times"></i> Tutup';
                        }
                    });
                });

                // Add click event to ayat items to set current ayat
                document.querySelectorAll('.ayat-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        // Only if not clicking on a button or link
                        if (!e.target.closest('button') && !e.target.closest('a')) {
                            const surahNumber = item.getAttribute('data-surah');
                            const ayatNumber = item.getAttribute('data-ayat');
                            currentAyat = ayatNumber;
                            updateBookmarkButton(surahNumber, ayatNumber);
                            saveLastRead(surahNumber, ayatNumber);
                        }
                    });
                });

                // Apply current font sizes
                updateFontSizes();
            }

            async function loadTafsir(surahNumber, ayatNumber, tafsirContentEl) {
                try {
                    const response = await fetch(`https://equran.id/api/v2/tafsir/${surahNumber}`);
                    const data = await response.json();
                    const tafsir = data.data.tafsir.find(t => t.ayat === parseInt(ayatNumber));
                    tafsirContentEl.innerHTML = tafsir ? tafsir.teks : 'Tafsir tidak tersedia untuk ayat ini.';
                } catch (error) {
                    console.error('Error fetching tafsir:', error);
                    tafsirContentEl.innerHTML = 'Gagal memuat tafsir. Silakan coba lagi.';
                }
            }

            function playFullSurah(surahNumber) {
                if (currentAudio) {
                    currentAudio.pause();
                    clearInterval(audioInterval);
                }
                
                const surah = surahs.find(s => s.nomor === surahNumber);
                const audioUrl = surah.audioFull[selectedQari];
                
                if (!audioUrl) {
                    alert('Audio tidak tersedia untuk qari ini');
                    return;
                }
                
                audioPlayerEl.classList.add('show');
                currentAudio = new Audio(audioUrl);
                
                // Set audio info
                audioTitleEl.textContent = `Surah ${surah.namaLatin}`;
                audioSurahEl.textContent = `Qari: ${qariSelect.options[qariSelect.selectedIndex].text}`;
                
                // Play audio
                currentAudio.play();
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                
                // Update duration when metadata is loaded
                currentAudio.addEventListener('loadedmetadata', () => {
                    durationEl.textContent = formatTime(currentAudio.duration);
                });
                
                // Update progress bar
                audioInterval = setInterval(updateProgress, 500);
                
                currentAudio.addEventListener('play', () => {
                    isPlaying = true;
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                });
                
                currentAudio.addEventListener('pause', () => {
                    isPlaying = false;
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                });
                
                currentAudio.addEventListener('ended', () => {
                    clearInterval(audioInterval);
                    isPlaying = false;
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                });
                
                // Click event for play/pause
                playPauseBtn.addEventListener('click', togglePlayPause);
                
                // Click event for progress bar
                progressContainer.addEventListener('click', setProgress);
            }

            function playAyat(surahNumber, ayatNumber) {
                if (currentAudio) {
                    currentAudio.pause();
                    clearInterval(audioInterval);
                }
                
                const surah = surahs.find(s => s.nomor === surahNumber);
                const ayat = surah.ayat.find(a => a.nomorAyat === parseInt(ayatNumber));
                const audioUrl = ayat.audio[selectedQari];
                
                if (!audioUrl) {
                    alert('Audio tidak tersedia untuk qari ini');
                    return;
                }
                
                audioPlayerEl.classList.add('show');
                currentAudio = new Audio(audioUrl);
                
                // Set audio info
                audioTitleEl.textContent = `Ayat ${ayatNumber}`;
                audioSurahEl.textContent = `${surah.namaLatin} (${surahNumber}:${ayatNumber}) - Qari: ${qariSelect.options[qariSelect.selectedIndex].text}`;
                
                // Play audio
                currentAudio.play();
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                
                // Update duration when metadata is loaded
                currentAudio.addEventListener('loadedmetadata', () => {
                    durationEl.textContent = formatTime(currentAudio.duration);
                });
                
                // Update progress bar
                audioInterval = setInterval(updateProgress, 500);
                
                currentAudio.addEventListener('play', () => {
                    isPlaying = true;
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                });
                
                currentAudio.addEventListener('pause', () => {
                    isPlaying = false;
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                });
                
                currentAudio.addEventListener('ended', () => {
                    clearInterval(audioInterval);
                    isPlaying = false;
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                });
                
                // Click event for play/pause
                playPauseBtn.addEventListener('click', togglePlayPause);
                
                // Click event for progress bar
                progressContainer.addEventListener('click', setProgress);
            }

            function togglePlayPause() {
                if (isPlaying) {
                    currentAudio.pause();
                } else {
                    currentAudio.play();
                }
            }

            function updateProgress() {
                if (!currentAudio) return;
                
                const { duration, currentTime } = currentAudio;
                const progressPercent = (currentTime / duration) * 100;
                progressBar.style.width = `${progressPercent}%`;
                
                // Update time display
                currentTimeEl.textContent = formatTime(currentTime);
            }

            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }

            function setProgress(e) {
                if (!currentAudio) return;
                
                const width = this.clientWidth;
                const clickX = e.offsetX;
                const duration = currentAudio.duration;
                currentAudio.currentTime = (clickX / width) * duration;
            }

            function toggleSettings() {
                settingsPanelEl.classList.toggle('open');
                overlayEl.classList.toggle('show');
                if (bookmarksPanelEl.classList.contains('open')) {
                    bookmarksPanelEl.classList.remove('open');
                }
                if (aboutModal.classList.contains('open')) {
                    aboutModal.classList.remove('open');
                }
                if (shareModal.classList.contains('open')) {
                    shareModal.classList.remove('open');
                }
            }

            function toggleBookmarksPanel() {
                bookmarksPanelEl.classList.toggle('open');
                overlayEl.classList.toggle('show');
                if (settingsPanelEl.classList.contains('open')) {
                    settingsPanelEl.classList.remove('open');
                }
                if (aboutModal.classList.contains('open')) {
                    aboutModal.classList.remove('open');
                }
                if (shareModal.classList.contains('open')) {
                    shareModal.classList.remove('open');
                }
            }

            function toggleTheme() {
                // Show animation
                themeAnimation.classList.add('active');
                
                setTimeout(() => {
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    setTheme(newTheme);
                    localStorage.setItem('theme', newTheme);
                    currentTheme = newTheme;
                    
                    // Hide animation
                    themeAnimation.classList.remove('active');
                    
                    // Add animation class
                    document.documentElement.classList.add('theme-transition');
                    setTimeout(() => {
                        document.documentElement.classList.remove('theme-transition');
                    }, 600);
                }, 300);
            }

            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                themeToggleBtn.innerHTML = `<i class="fas ${theme === 'dark' ? 'fa-sun' : 'fa-moon'}"></i>`;
            }

            function updateFontSizes() {
                const arabicSize = arabicFontSize.value;
                const translationSize = translationFontSize.value;
                const latinSize = latinFontSize.value;
                
                document.querySelectorAll('.ayat-arabic').forEach(el => {
                    el.style.fontSize = `${arabicSize}px`;
                });
                
                document.querySelectorAll('.ayat-translation').forEach(el => {
                    el.style.fontSize = `${translationSize}px`;
                });
                
                document.querySelectorAll('.ayat-latin').forEach(el => {
                    el.style.fontSize = `${latinSize}px`;
                });
                
                // Update displayed values
                arabicFontSizeValue.textContent = arabicSize;
                translationFontSizeValue.textContent = translationSize;
                latinFontSizeValue.textContent = latinSize;
                
                // Save to localStorage
                localStorage.setItem('arabicFontSize', arabicSize);
                localStorage.setItem('translationFontSize', translationSize);
                localStorage.setItem('latinFontSize', latinSize);
            }

            function updateFontSizeValues() {
                const savedArabicSize = localStorage.getItem('arabicFontSize') || 24;
                const savedTranslationSize = localStorage.getItem('translationFontSize') || 16;
                const savedLatinSize = localStorage.getItem('latinFontSize') || 14;
                
                arabicFontSize.value = savedArabicSize;
                translationFontSize.value = savedTranslationSize;
                latinFontSize.value = savedLatinSize;
                
                arabicFontSizeValue.textContent = savedArabicSize;
                translationFontSizeValue.textContent = savedTranslationSize;
                latinFontSizeValue.textContent = savedLatinSize;
            }

            function updateQari() {
                selectedQari = qariSelect.value;
                localStorage.setItem('qari', selectedQari);
                
                // If audio is playing, restart with new qari
                if (currentAudio && currentSurah) {
                    if (audioTitleEl.textContent.includes('Ayat')) {
                        const ayatNumber = audioTitleEl.textContent.split(' ')[1];
                        playAyat(currentSurah.nomor, ayatNumber);
                    } else {
                        playFullSurah(currentSurah.nomor);
                    }
                }
            }

            function filterSurahs() {
                const searchTerm = searchBox.value.toLowerCase();
                const filteredSurahs = surahs.filter(surah => 
                    surah.namaLatin.toLowerCase().includes(searchTerm) || 
                    surah.nama.toLowerCase().includes(searchTerm) ||
                    surah.arti.toLowerCase().includes(searchTerm)
                );
                renderSurahList(filteredSurahs);
            }

            function resetSettings() {
                // Reset theme
                const defaultTheme = 'light';
                setTheme(defaultTheme);
                themeSwitch.checked = false;
                localStorage.setItem('theme', defaultTheme);
                currentTheme = defaultTheme;
                
                // Reset font sizes
                const defaultArabicSize = 24;
                const defaultTranslationSize = 16;
                const defaultLatinSize = 14;
                arabicFontSize.value = defaultArabicSize;
                translationFontSize.value = defaultTranslationSize;
                latinFontSize.value = defaultLatinSize;
                arabicFontSizeValue.textContent = defaultArabicSize;
                translationFontSizeValue.textContent = defaultTranslationSize;
                latinFontSizeValue.textContent = defaultLatinSize;
                updateFontSizes();
                
                // Reset qari
                const defaultQari = '01';
                qariSelect.value = defaultQari;
                localStorage.setItem('qari', defaultQari);
                selectedQari = defaultQari;
                
                // Show confirmation
                alert('Pengaturan telah direset ke default');
            }

            function toggleBookmark() {
                if (!currentSurah || !currentAyat) return;
                
                const surahNumber = currentSurah.nomor;
                const ayatNumber = currentAyat;
                const bookmarkIndex = bookmarks.findIndex(b => b.surah === surahNumber && b.ayat === ayatNumber);
                
                if (bookmarkIndex === -1) {
                    // Add bookmark
                    const surah = surahs.find(s => s.nomor === surahNumber);
                    const ayat = surah.ayat.find(a => a.nomorAyat === parseInt(ayatNumber));
                    
                    bookmarks.push({
                        surah: surahNumber,
                        ayat: ayatNumber,
                        surahName: surah.namaLatin,
                        arabicText: ayat.teksArab,
                        latinText: ayat.teksLatin,
                        translation: ayat.teksIndonesia,
                        timestamp: new Date().toISOString()
                    });
                    
                    bookmarkBtn.innerHTML = '<i class="fas fa-bookmark"></i>';
                    bookmarkBtn.classList.add('bookmarked');
                    
                    // Show notification
                    showNotification('Ayat telah dibookmark');
                } else {
                    // Remove bookmark
                    bookmarks.splice(bookmarkIndex, 1);
                    bookmarkBtn.innerHTML = '<i class="far fa-bookmark"></i>';
                    bookmarkBtn.classList.remove('bookmarked');
                    
                    // Show notification
                    showNotification('Bookmark dihapus');
                }
                
                // Save to localStorage
                localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
                renderBookmarks();
            }
            
            function showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                notification.style.position = 'fixed';
                notification.style.bottom = '20px';
                notification.style.left = '50%';
                notification.style.transform = 'translateX(-50%)';
                notification.style.backgroundColor = 'var(--primary)';
                notification.style.color = 'white';
                notification.style.padding = '10px 20px';
                notification.style.borderRadius = 'var(--radius)';
                notification.style.boxShadow = 'var(--shadow)';
                notification.style.zIndex = '2000';
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '1';
                }, 10);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            function updateBookmarkButton(surahNumber, ayatNumber) {
                const isBookmarked = bookmarks.some(b => b.surah === surahNumber && b.ayat === ayatNumber);
                
                if (isBookmarked) {
                    bookmarkBtn.innerHTML = '<i class="fas fa-bookmark"></i>';
                    bookmarkBtn.classList.add('bookmarked');
                } else {
                    bookmarkBtn.innerHTML = '<i class="far fa-bookmark"></i>';
                    bookmarkBtn.classList.remove('bookmarked');
                }
            }

            function renderBookmarks() {
                if (bookmarks.length === 0) {
                    bookmarksListEl.innerHTML = `
                        <div class="empty-state">
                            <i class="far fa-bookmark"></i>
                            <p>Belum ada ayat yang dibookmark</p>
                        </div>
                    `;
                    return;
                }
                
                // Sort by most recent first
                bookmarks.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                let html = '';
                bookmarks.forEach((bookmark, index) => {
                    html += `
                        <div class="bookmark-item" data-surah="${bookmark.surah}" data-ayat="${bookmark.ayat}">
                            <div class="surah-number">${bookmark.surah}</div>
                            <div class="surah-name">${bookmark.surahName} : ${bookmark.ayat}</div>
                            <div class="surah-details">
                                <div class="surah-ayat">${bookmark.arabicText.substring(0, 20)}...</div>
                            </div>
                            <div class="bookmark-actions">
                                <button class="bookmark-delete" data-index="${index}" title="Hapus bookmark">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                bookmarksListEl.innerHTML = html;
                
                // Add click event to bookmark items
                document.querySelectorAll('.bookmark-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        // Don't navigate if delete button was clicked
                        if (e.target.closest('.bookmark-delete')) return;
                        
                        const surahNumber = parseInt(item.getAttribute('data-surah'));
                        const ayatNumber = parseInt(item.getAttribute('data-ayat'));
                        
                        // Load the surah
                        loadSurah(surahNumber);
                        
                        // Close bookmarks panel
                        bookmarksPanelEl.classList.remove('open');
                        overlayEl.classList.remove('show');
                        
                        // Scroll to the ayat after a short delay
                        setTimeout(() => {
                            const ayatElement = document.querySelector(`.ayat-item[data-surah="${surahNumber}"][data-ayat="${ayatNumber}"]`);
                            if (ayatElement) {
                                ayatElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                
                                // Highlight the ayat temporarily
                                ayatElement.style.backgroundColor = 'var(--primary-transparent)';
                                setTimeout(() => {
                                    ayatElement.style.backgroundColor = '';
                                }, 2000);
                                
                                // Set current ayat and update bookmark button
                                currentAyat = ayatNumber;
                                updateBookmarkButton(surahNumber, ayatNumber);
                            }
                        }, 500);
                    });
                });
                
                // Add click event to delete buttons
                document.querySelectorAll('.bookmark-delete').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const index = btn.getAttribute('data-index');
                        
                        if (confirm('Hapus bookmark ini?')) {
                            bookmarks.splice(index, 1);
                            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
                            renderBookmarks();
                            
                            // Update bookmark button if the deleted bookmark is the current ayat
                            if (currentSurah && currentAyat) {
                                const isStillBookmarked = bookmarks.some(b => 
                                    b.surah === currentSurah.nomor && b.ayat === currentAyat
                                );
                                
                                if (!isStillBookmarked) {
                                    bookmarkBtn.innerHTML = '<i class="far fa-bookmark"></i>';
                                    bookmarkBtn.classList.remove('bookmarked');
                                }
                            }
                        }
                    });
                });
            }
            
            function openShareModal() {
                if (!currentSurah || !currentAyat) {
                    alert('Pilih ayat dulu, baru share!');
                    return;
                }
                
                const surahNumber = currentSurah.nomor;
                const ayatNumber = currentAyat;
                const shareUrl = `${window.location.origin}${window.location.pathname}?surah=${surahNumber}&ayat=${ayatNumber}`;
                
                shareLinkInput.value = shareUrl;
                shareModal.classList.add('open');
                overlayEl.classList.add('show');
            }
            
            function closeShareModalFunc() {
                shareModal.classList.remove('open');
                overlayEl.classList.remove('show');
            }
            
            function copyShareLink() {
                shareLinkInput.select();
                document.execCommand('copy');
                
                // Change button text temporarily
                const originalText = copyLinkBtn.textContent;
                copyLinkBtn.textContent = 'Tersalin!';
                
                setTimeout(() => {
                    copyLinkBtn.textContent = originalText;
                }, 2000);
            }
            
            function shareToWhatsApp() {
                const shareUrl = shareLinkInput.value;
                const text = `Baca Surah ${currentSurah.namaLatin} Ayat ${currentAyat} di Al-Quran Digital: ${shareUrl}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            }
            
            function shareToFacebook() {
                const shareUrl = shareLinkInput.value;
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
            }
            
            function shareToTwitter() {
                const shareUrl = shareLinkInput.value;
                const text = `Baca Surah ${currentSurah.namaLatin} Ayat ${currentAyat} di Al-Quran Digital`;
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(shareUrl)}`, '_blank');
            }
            
            function shareToTelegram() {
                const shareUrl = shareLinkInput.value;
                const text = `Baca Surah ${currentSurah.namaLatin} Ayat ${currentAyat} di Al-Quran Digital: ${shareUrl}`;
                window.open(`https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(text)}`, '_blank');
            }

            function closeAllPanels() {
                settingsPanelEl.classList.remove('open');
                bookmarksPanelEl.classList.remove('open');
                aboutModal.classList.remove('open');
                shareModal.classList.remove('open');
                overlayEl.classList.remove('show');
            }
            
            function openAboutModal() {
                aboutModal.classList.add('open');
                overlayEl.classList.add('show');
            }
            
            function closeAboutModalFunc() {
                aboutModal.classList.remove('open');
                overlayEl.classList.remove('show');
            }
        });
    </script>
</body>
</html>